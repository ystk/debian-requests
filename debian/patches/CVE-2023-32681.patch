From: Markus Koschany <apo@debian.org>
Date: Fri, 16 Jun 2023 22:58:17 +0200
Subject: CVE-2023-32681

Bug-Debian: https://bugs.debian.org/1036693
Origin: https://github.com/psf/requests/commit/74ea7cf7a6a27a4eeb2ae24e162bcc942a6706d5
---
 requests/sessions.py | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/requests/sessions.py b/requests/sessions.py
index 81addbd..7c9740a 100644
--- a/requests/sessions.py
+++ b/requests/sessions.py
@@ -251,7 +251,9 @@ class SessionRedirectMixin(object):
         except KeyError:
             username, password = None, None
 
-        if username and password:
+        # urllib3 handles proxy authorization for us in the standard adapter.
+        # Avoid appending this to TLS tunneled requests where it may be leaked.
+        if not scheme.startswith('https') and username and password:
             headers['Proxy-Authorization'] = _basic_auth_str(username, password)
 
         return new_proxies
